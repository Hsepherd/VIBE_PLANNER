# Story S-008: æ•´åˆ - å°è©±è§¸ç™¼æ’ç¨‹æµç¨‹

> **Story ID**: S-008
> **Epic**: EPIC-001 AI æ™ºæ…§æ’ç¨‹ Phase 1
> **ä¼°è¨ˆé»æ•¸**: 5
> **å„ªå…ˆç´š**: P1
> **ä¾è³´**: S-004, S-005, S-006, S-007

---

## User Story

**ä½œç‚º** ä½¿ç”¨è€…
**æˆ‘æƒ³è¦** åœ¨å°è©±ä¸­èªªã€Œå¹«æˆ‘æ’ä»Šå¤©è¡Œç¨‹ã€å°±èƒ½è§¸ç™¼æ’ç¨‹
**ä»¥ä¾¿** ç”¨æœ€è‡ªç„¶çš„æ–¹å¼å®Œæˆä»»å‹™è¦åŠƒ

---

## é©—æ”¶æ¨™æº– (Acceptance Criteria)

### AC1: è§¸ç™¼æ’ç¨‹
```gherkin
Given ä½¿ç”¨è€…åœ¨å°è©±æ¡†è¼¸å…¥ã€Œå¹«æˆ‘æ’ä»Šå¤©è¡Œç¨‹ã€
When AI è™•ç†è¨Šæ¯
Then AI å‘¼å«ç›¸é—œ functions (getUnscheduledTasks, getAvailableSlots)
Then AI åŸ·è¡Œæ’ç¨‹æ¼”ç®—æ³•
Then é¡¯ç¤ºæ’ç¨‹é è¦½é¢æ¿
And AI å›è¦†æ’ç¨‹æ‘˜è¦
```

### AC2: å¤šç¨®è§¸ç™¼èªå¥
```gherkin
Given ä½¿ç”¨è€…èªªä»¥ä¸‹ä»»ä¸€èªå¥ï¼š
  - ã€Œå¹«æˆ‘æ’ä»Šå¤©è¡Œç¨‹ã€
  - ã€Œæ’ä¸€ä¸‹ä»Šå¤©ã€
  - ã€Œschedule todayã€
  - ã€Œå®‰æ’ä»Šå¤©çš„ä»»å‹™ã€
  - ã€Œä»Šå¤©è¦åšä»€éº¼ã€
When AI è™•ç†è¨Šæ¯
Then è§¸ç™¼æ’ç¨‹æµç¨‹
```

### AC3: æŒ‡å®šæ—¥æœŸç¯„åœ
```gherkin
Given ä½¿ç”¨è€…èªªã€Œå¹«æˆ‘æ’é€™é€±çš„è¡Œç¨‹ã€
When AI è™•ç†è¨Šæ¯
Then æ’ç¨‹ç¯„åœç‚ºæœ¬é€±ä¸€åˆ°é€±æ—¥
And é¡¯ç¤ºæ•´é€±çš„æ’ç¨‹é è¦½
```

### AC4: æ’ç¨‹çµæœåœ¨å°è©±é¡¯ç¤º
```gherkin
Given AI å®Œæˆæ’ç¨‹è¨ˆç®—
When é¡¯ç¤ºçµæœ
Then å°è©±ä¸­é¡¯ç¤ºæ‘˜è¦æ–‡å­—
And è‡ªå‹•é–‹å•Ÿæ’ç¨‹é è¦½é¢æ¿
And å°è©±ä¸­åµŒå…¥ã€Œç¢ºèªæ’ç¨‹ã€æŒ‰éˆ•
```

### AC5: æ’ç¨‹å¾Œç¢ºèª
```gherkin
Given ä½¿ç”¨è€…åœ¨é è¦½é¢æ¿é»æ“Šã€Œç¢ºèªæ’ç¨‹ã€
When æ’ç¨‹æˆåŠŸ
Then å°è©±ä¸­é¡¯ç¤ºã€Œâœ… å·²æ’å…¥ 5 å€‹ä»»å‹™ã€
And é è¦½é¢æ¿é—œé–‰
And è¡Œäº‹æ›†é é¢æ›´æ–°
```

### AC6: æ’ç¨‹å¤±æ•—è™•ç†
```gherkin
Given æ’ç¨‹éç¨‹ç™¼ç”ŸéŒ¯èª¤
When é¡¯ç¤ºçµæœ
Then AI å›è¦†éŒ¯èª¤è¨Šæ¯
And æä¾›å¯èƒ½çš„è§£æ±ºæ–¹æ¡ˆ
```

---

## æ•´åˆæµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        å°è©±ä»‹é¢                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  ğŸ‘¤ å¹«æˆ‘æ’ä»Šå¤©è¡Œç¨‹                                           â”‚
â”‚                                                             â”‚
â”‚  ğŸ¤– å¥½çš„ï¼Œè®“æˆ‘åˆ†æä½ çš„ä»»å‹™å’Œè¡Œäº‹æ›†...                         â”‚
â”‚                                                             â”‚
â”‚     [æ­£åœ¨åˆ†æ] å–å¾—ä»»å‹™æ¸…å–®                                  â”‚
â”‚     [æ­£åœ¨åˆ†æ] æª¢æŸ¥ä»Šæ—¥è¡Œäº‹æ›†                                â”‚
â”‚     [æ­£åœ¨è¨ˆç®—] å®‰æ’æœ€ä½³æ™‚æ®µ                                  â”‚
â”‚                                                             â”‚
â”‚  ğŸ¤– æˆ‘å·²ç¶“å¹«ä½ å®‰æ’å¥½ä»Šå¤©çš„è¡Œç¨‹ï¼                              â”‚
â”‚                                                             â”‚
â”‚     ğŸ“Š æ’ç¨‹æ‘˜è¦                                              â”‚
â”‚     â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                    â”‚
â”‚     âœ… 5 å€‹ä»»å‹™å·²å®‰æ’                                        â”‚
â”‚     â° ç¸½è¨ˆ 6 å°æ™‚å·¥ä½œ                                       â”‚
â”‚     âš ï¸ 1 å€‹ä»»å‹™ç„¡æ³•æ’å…¥ï¼ˆæ™‚é–“ä¸è¶³ï¼‰                          â”‚
â”‚                                                             â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                     â”‚
â”‚     â”‚  [æŸ¥çœ‹è©³ç´°æ’ç¨‹]  [ç¢ºèªæ’ç¨‹]      â”‚                     â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æ’ç¨‹é è¦½é¢æ¿                              â”‚
â”‚                   (S-007 å…ƒä»¶)                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## æŠ€è¡“æ¶æ§‹

### å°è©±è™•ç†æµç¨‹

```typescript
// åœ¨ chat stream è™•ç†ä¸­

// 1. AI åˆ¤æ–·æ˜¯å¦ç‚ºæ’ç¨‹è«‹æ±‚
// 2. å¦‚æœæ˜¯ï¼ŒAI æœƒå‘¼å« functions

// è™•ç† function call çµæœ
if (functionName === 'createSchedulePreview') {
  // å°‡æ’ç¨‹çµæœå‚³çµ¦å‰ç«¯
  // å‰ç«¯é–‹å•Ÿæ’ç¨‹é è¦½é¢æ¿
  sendStreamEvent({
    type: 'schedule_preview',
    data: scheduleResult,
  });
}
```

### å‰ç«¯è™•ç†

```typescript
// components/chat/ChatWindow.tsx

function handleStreamEvent(event: StreamEvent) {
  switch (event.type) {
    case 'schedule_preview':
      // é–‹å•Ÿæ’ç¨‹é è¦½é¢æ¿
      setSchedulePreview(event.data);
      setShowSchedulePanel(true);
      break;
    case 'schedule_confirmed':
      // é¡¯ç¤ºæˆåŠŸè¨Šæ¯
      addMessage({
        role: 'assistant',
        content: `âœ… å·²æˆåŠŸæ’å…¥ ${event.data.count} å€‹ä»»å‹™ï¼`,
      });
      break;
  }
}
```

### AI å›è¦†æ¨¡æ¿

```typescript
const SCHEDULE_RESPONSE_TEMPLATE = `
æˆ‘å·²ç¶“å¹«ä½ å®‰æ’å¥½{dateRange}çš„è¡Œç¨‹ï¼

ğŸ“Š **æ’ç¨‹æ‘˜è¦**
- âœ… {scheduledCount} å€‹ä»»å‹™å·²å®‰æ’
- â° ç¸½è¨ˆ {totalHours} å°æ™‚å·¥ä½œ
{warnings}

{preview}

è«‹åœ¨å³å´é è¦½é¢æ¿ç¢ºèªæˆ–èª¿æ•´æ’ç¨‹ã€‚
`;
```

---

## æŠ€è¡“ä»»å‹™

- [ ] ä¿®æ”¹ `ChatWindow.tsx` è™•ç†æ’ç¨‹äº‹ä»¶
- [ ] æ–°å¢ `schedule_preview` äº‹ä»¶é¡å‹
- [ ] æ•´åˆæ’ç¨‹é è¦½é¢æ¿åˆ°å°è©±ä»‹é¢
- [ ] å¯¦ä½œæ’ç¨‹æ‘˜è¦è¨Šæ¯å…ƒä»¶
- [ ] å¯¦ä½œåµŒå…¥å¼æ“ä½œæŒ‰éˆ•
- [ ] è™•ç†æ’ç¨‹ç¢ºèªå¾Œçš„è¨Šæ¯æ›´æ–°
- [ ] è™•ç†éŒ¯èª¤æƒ…æ³
- [ ] æ¸¬è©¦å®Œæ•´æµç¨‹

---

## Stream äº‹ä»¶æ ¼å¼

```typescript
// æ–°å¢çš„äº‹ä»¶é¡å‹
interface SchedulePreviewEvent {
  type: 'schedule_preview';
  data: {
    schedules: Schedule[];
    unscheduled: UnscheduledTask[];
    warnings: string[];
    stats: {
      totalTasks: number;
      scheduledTasks: number;
      totalMinutes: number;
    };
    dateRange: {
      start: string;
      end: string;
    };
  };
}

interface ScheduleConfirmedEvent {
  type: 'schedule_confirmed';
  data: {
    count: number;
    tasks: Array<{ id: string; title: string }>;
  };
}
```

---

## æ¸¬è©¦æ¡ˆä¾‹

| # | æ¸¬è©¦ | é æœŸçµæœ |
|---|------|----------|
| 1 | èªªã€Œå¹«æˆ‘æ’ä»Šå¤©è¡Œç¨‹ã€| è§¸ç™¼æ’ç¨‹ + é¡¯ç¤ºé è¦½ |
| 2 | èªªã€Œæ’é€™é€±ã€| æ•´é€±æ’ç¨‹ |
| 3 | èªªã€ŒæŠŠæ˜å¤©çš„ä»»å‹™æ’å¥½ã€| æ˜å¤©æ’ç¨‹ |
| 4 | ç„¡å¾…æ’ä»»å‹™ | AI å›è¦†ã€Œæ²’æœ‰éœ€è¦æ’çš„ä»»å‹™ã€|
| 5 | Google Calendar æœªé€£æ¥ | é¡¯ç¤ºè­¦å‘Šä½†ä»å¯æ’ç¨‹ |
| 6 | ç¢ºèªæ’ç¨‹ | ä»»å‹™æ›´æ–° + æˆåŠŸè¨Šæ¯ |
| 7 | å–æ¶ˆæ’ç¨‹ | é è¦½é—œé–‰ï¼Œç„¡è®Šæ›´ |

---

## Definition of Done

- [ ] å°è©±è§¸ç™¼æ’ç¨‹æ­£å¸¸
- [ ] å¤šç¨®èªå¥éƒ½èƒ½è§¸ç™¼
- [ ] æ’ç¨‹é è¦½æ­£ç¢ºé¡¯ç¤º
- [ ] åµŒå…¥å¼æŒ‰éˆ•æ­£å¸¸é‹ä½œ
- [ ] ç¢ºèªæ’ç¨‹å¾Œæ›´æ–°æ­£ç¢º
- [ ] éŒ¯èª¤è™•ç†æ­£å¸¸
- [ ] ç«¯å°ç«¯æ¸¬è©¦é€šé
