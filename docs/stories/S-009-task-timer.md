# Story S-009: ä»»å‹™è¨ˆæ™‚åŠŸèƒ½

> **Story ID**: S-009
> **Epic**: EPIC-002 AI æ™ºæ…§æ’ç¨‹ Phase 2
> **ä¼°è¨ˆé»æ•¸**: 5
> **å„ªå…ˆç´š**: P2
> **ä¾è³´**: EPIC-001 å®Œæˆ

---

## User Story

**ä½œç‚º** ä½¿ç”¨è€…
**æˆ‘æƒ³è¦** èƒ½ç‚ºæ­£åœ¨åŸ·è¡Œçš„ä»»å‹™è¨ˆæ™‚
**ä»¥ä¾¿** ç³»çµ±å¯ä»¥è¨˜éŒ„æˆ‘å¯¦éš›èŠ±è²»çš„æ™‚é–“ï¼Œç”¨æ–¼æœªä¾†çš„é ä¼°å„ªåŒ–

---

## é©—æ”¶æ¨™æº– (Acceptance Criteria)

### AC1: é–‹å§‹è¨ˆæ™‚
```gherkin
Given ä¸€å€‹æœªé–‹å§‹çš„ä»»å‹™
When ä½¿ç”¨è€…é»æ“Šã€Œé–‹å§‹ã€æŒ‰éˆ•
Then è¨ˆæ™‚å™¨é–‹å§‹è¨ˆæ™‚
And ä»»å‹™ç‹€æ…‹è®Šç‚ºã€Œé€²è¡Œä¸­ã€
And è¨˜éŒ„ started_at æ™‚é–“æˆ³
And é¡¯ç¤ºç¶“éæ™‚é–“
```

### AC2: æš«åœè¨ˆæ™‚
```gherkin
Given ä¸€å€‹æ­£åœ¨è¨ˆæ™‚çš„ä»»å‹™
When ä½¿ç”¨è€…é»æ“Šã€Œæš«åœã€æŒ‰éˆ•
Then è¨ˆæ™‚å™¨æš«åœ
And è¨˜éŒ„æœ¬æ¬¡è¨ˆæ™‚å€é–“åˆ° time_entries
And å¯ä»¥ç¹¼çºŒè¨ˆæ™‚
```

### AC3: çµæŸè¨ˆæ™‚
```gherkin
Given ä¸€å€‹æ­£åœ¨è¨ˆæ™‚çš„ä»»å‹™
When ä½¿ç”¨è€…é»æ“Šã€Œå®Œæˆã€æŒ‰éˆ•
Then è¨ˆæ™‚å™¨åœæ­¢
And è¨˜éŒ„ completed_at æ™‚é–“æˆ³
And è¨ˆç®— actual_minutes
And ä»»å‹™ç‹€æ…‹è®Šç‚ºã€Œå·²å®Œæˆã€
```

### AC4: å¤šä»»å‹™è¨ˆæ™‚
```gherkin
Given ä»»å‹™ A æ­£åœ¨è¨ˆæ™‚
When ä½¿ç”¨è€…é–‹å§‹ä»»å‹™ B çš„è¨ˆæ™‚
Then ä»»å‹™ A è‡ªå‹•æš«åœ
And ä»»å‹™ B é–‹å§‹è¨ˆæ™‚
And é¡¯ç¤ºæç¤ºã€Œå·²æš«åœä»»å‹™ Aã€
```

### AC5: æ‰‹å‹•è¼¸å…¥æ™‚é–“
```gherkin
Given ä½¿ç”¨è€…å®Œæˆä»»å‹™ä½†æ²’æœ‰ä½¿ç”¨è¨ˆæ™‚å™¨
When ä½¿ç”¨è€…æ‰‹å‹•è¼¸å…¥å¯¦éš›èŠ±è²»æ™‚é–“
Then è¨˜éŒ„ actual_minutes
And ä¸å½±éŸ¿ time_entries
```

---

## UI è¨­è¨ˆ

### ä»»å‹™å¡ç‰‡ - è¨ˆæ™‚ç‹€æ…‹

**æœªé–‹å§‹**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“‹ æº–å‚™é€±æœƒç°¡å ±                      â”‚
â”‚    é ä¼° 1.5 å°æ™‚                     â”‚
â”‚                        [â–¶ï¸ é–‹å§‹]     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**è¨ˆæ™‚ä¸­**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“‹ æº–å‚™é€±æœƒç°¡å ±              ğŸ”´ è¨ˆæ™‚ä¸­ â”‚
â”‚    â±ï¸ 00:45:32                      â”‚
â”‚                    [â¸ï¸ æš«åœ] [âœ… å®Œæˆ] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**å·²æš«åœ**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“‹ æº–å‚™é€±æœƒç°¡å ±              â¸ï¸ å·²æš«åœ â”‚
â”‚    â±ï¸ 00:45:32 (æš«åœä¸­)             â”‚
â”‚                   [â–¶ï¸ ç¹¼çºŒ] [âœ… å®Œæˆ] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å…¨å±€è¨ˆæ™‚æŒ‡ç¤ºå™¨

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ”´ æ­£åœ¨è¨ˆæ™‚: æº–å‚™é€±æœƒç°¡å ±  00:45:32  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## è³‡æ–™çµæ§‹

### time_entries æ ¼å¼

```typescript
interface TimeEntry {
  id: string;
  startedAt: string;  // ISO timestamp
  endedAt?: string;   // ISO timestamp, null if ongoing
  durationMinutes?: number;
  note?: string;
}

// ç¯„ä¾‹
const timeEntries: TimeEntry[] = [
  {
    id: "entry-1",
    startedAt: "2026-01-19T09:00:00Z",
    endedAt: "2026-01-19T09:45:00Z",
    durationMinutes: 45
  },
  {
    id: "entry-2",
    startedAt: "2026-01-19T10:30:00Z",
    endedAt: "2026-01-19T11:15:00Z",
    durationMinutes: 45
  }
];
// actual_minutes = 90
```

---

## æŠ€è¡“ä»»å‹™

- [ ] è³‡æ–™åº« migration: æ–°å¢ time_entries, started_at, completed_at
- [ ] å»ºç«‹ `useTaskTimer` hook
- [ ] å¯¦ä½œè¨ˆæ™‚å™¨ UI å…ƒä»¶
- [ ] å¯¦ä½œé–‹å§‹/æš«åœ/ç¹¼çºŒ/å®Œæˆé‚è¼¯
- [ ] å¯¦ä½œå¤šä»»å‹™è‡ªå‹•æš«åœ
- [ ] å…¨å±€è¨ˆæ™‚æŒ‡ç¤ºå™¨
- [ ] æ‰‹å‹•è¼¸å…¥æ™‚é–“åŠŸèƒ½
- [ ] è¨ˆæ™‚è³‡æ–™æŒä¹…åŒ–ï¼ˆé˜²æ­¢é é¢é‡æ–°æ•´ç†éºå¤±ï¼‰
- [ ] åŒæ­¥è¨ˆæ™‚è³‡æ–™åˆ° Supabase

---

## API ç«¯é»

| æ–¹æ³• | è·¯å¾‘ | èªªæ˜ |
|------|------|------|
| POST | `/api/tasks/:id/timer/start` | é–‹å§‹è¨ˆæ™‚ |
| POST | `/api/tasks/:id/timer/pause` | æš«åœè¨ˆæ™‚ |
| POST | `/api/tasks/:id/timer/resume` | ç¹¼çºŒè¨ˆæ™‚ |
| POST | `/api/tasks/:id/timer/stop` | çµæŸè¨ˆæ™‚ |
| PATCH | `/api/tasks/:id/actual-time` | æ‰‹å‹•è¨­å®šå¯¦éš›æ™‚é–“ |

---

## æ¸¬è©¦æ¡ˆä¾‹

| # | æ¸¬è©¦ | é æœŸçµæœ |
|---|------|----------|
| 1 | é–‹å§‹è¨ˆæ™‚ | è¨ˆæ™‚å™¨é–‹å§‹ï¼Œç‹€æ…‹æ›´æ–° |
| 2 | æš«åœè¨ˆæ™‚ | è¨ˆæ™‚æš«åœï¼Œè¨˜éŒ„ entry |
| 3 | ç¹¼çºŒè¨ˆæ™‚ | è¨ˆæ™‚ç¹¼çºŒï¼Œæ–° entry |
| 4 | å®Œæˆè¨ˆæ™‚ | è¨ˆæ™‚åœæ­¢ï¼Œè¨ˆç®—ç¸½æ™‚é–“ |
| 5 | å¤šä»»å‹™åˆ‡æ› | å‰ä¸€å€‹è‡ªå‹•æš«åœ |
| 6 | é é¢é‡æ–°æ•´ç† | è¨ˆæ™‚ç‹€æ…‹ä¿æŒ |
| 7 | æ‰‹å‹•è¼¸å…¥æ™‚é–“ | æ­£ç¢ºè¨˜éŒ„ |

---

## Definition of Done

- [ ] è¨ˆæ™‚åŠŸèƒ½æ­£å¸¸é‹ä½œ
- [ ] æš«åœ/ç¹¼çºŒåŠŸèƒ½æ­£å¸¸
- [ ] å¤šä»»å‹™è‡ªå‹•æš«åœ
- [ ] è¨ˆæ™‚è³‡æ–™æŒä¹…åŒ–
- [ ] æ‰‹å‹•è¼¸å…¥åŠŸèƒ½
- [ ] Mobile éŸ¿æ‡‰å¼
- [ ] æ¸¬è©¦æ¡ˆä¾‹é€šé
