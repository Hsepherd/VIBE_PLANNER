'use client'

import { useRef, useEffect } from 'react'
import { useAppStore, type AppState, type Message } from '@/lib/store'
import MessageBubble from './MessageBubble'

export default function ChatWindow() {
  const messages = useAppStore((state: AppState) => state.messages)
  const scrollRef = useRef<HTMLDivElement>(null)
  const containerRef = useRef<HTMLDivElement>(null)

  // è‡ªå‹•æ²å‹•åˆ°æœ€æ–°è¨Šæ¯
  useEffect(() => {
    if (scrollRef.current) {
      scrollRef.current.scrollIntoView({ behavior: 'smooth' })
    }
  }, [messages])

  return (
    <div
      ref={containerRef}
      className="flex-1 overflow-y-auto p-4"
    >
      <div className="space-y-4 max-w-3xl mx-auto">
        {messages.length === 0 ? (
          <div className="text-center text-muted-foreground py-12">
            <div className="text-4xl mb-4">ğŸ‘‹</div>
            <h3 className="text-lg font-medium mb-2">æ­¡è¿ä½¿ç”¨ Vibe Planner</h3>
            <p className="text-sm">
              æˆ‘æ˜¯ä½ çš„ AI åŠ©ç†ï¼Œå¯ä»¥å¹«ä½ ï¼š
            </p>
            <ul className="text-sm mt-2 space-y-1">
              <li>ğŸ“‹ å¾æœƒè­°é€å­—ç¨¿èƒå–ä»»å‹™</li>
              <li>âœ… è¿½è¹¤å’Œç®¡ç†å¾…è¾¦äº‹é …</li>
              <li>ğŸ’¡ æä¾›æ™ºæ…§å»ºè­°</li>
              <li>ğŸ“¸ åˆ†ææˆªåœ–å…§å®¹</li>
            </ul>
            <p className="text-sm mt-4 text-muted-foreground">
              è©¦è‘—è²¼ä¸Šä¸€æ®µæœƒè­°è¨˜éŒ„ï¼Œæˆ–å‘Šè¨´æˆ‘ä½ æƒ³åšä»€éº¼ï¼
            </p>
          </div>
        ) : (
          messages.map((message: Message) => (
            <MessageBubble key={message.id} message={message} />
          ))
        )}
        <div ref={scrollRef} />
      </div>
    </div>
  )
}
